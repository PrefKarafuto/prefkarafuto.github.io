---
title: ぜろちゃんねるプラスのプラグイン
permalink: /docs/0chplus-plugin/
---
## EXぜろちゃんねるへの移行に伴う対応 
v0.7.5まで、ぜろちゃんねるプラスはShift-JISでエンコードされていました。しかしGitHubでの開発にあたっては不便であり、かつ正規表現などを扱う際に手間がかかるという問題が有りました。
そこで、v0.8.0からはエンコードをUTF-8に変更しました。これによってperl中の日本語文字列は格段に扱いやすくなりました。
しかし、Shift-JISでエンコードされた大部分のプラグインファイルは、そのまま現バージョンで読み込もうとすると文字化けや文字列操作における意図しない挙動などを引き起こすため、そのままでは使用できません。そこで、ユーザ側でのプラグイン書き換えのヒントとなる条項を下に示します。

### スクリプトの文字コードをUTF-8に変換
メモ帳などでスクリプトファイルを開き、「ファイル→名前をつけて保存」で、文字コードにUTF-8を選択して保存する。
### 冒頭にutf8プラグマを記述する
```perl
package ZPL_xxx;
```  
となっている部分を  
```perl
package ZPL_xxx;
use utf8;
```  
と書き加える。
### (ファイルを読み書きする操作がある場合)冒頭にopenプラグマを記述する
```perl
package ZPL_xxx;
use utf8;
```
を
```perl
package ZPL_xxx;
use utf8;
use open IO=>':encoding(cp932)';
```
とする。
IOの部分は「IN」で読込、「OUT」で書出をcp932(Shift-JIS)で行う設定である。IOは読み書き両用となる。
UTF-8を指定したい場合、```':encoding(cp932)';```を```':utf8';```にする。

### モジュールファイル名、パッケージ名の書き換え
v0.8.0より、moduleフォルダ内のファイル名及びパッケージ名は、これまで指輪物語のキャラ名だったものから、モジュールの機能を表した適切な名称に変更されている。
そのため、[対応表](https://github.com/PrefKarafuto/New_0ch_Plus/wiki/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%83%BB%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E5%90%8D%E5%AF%BE%E5%BF%9C%E8%A1%A8)をもとに適宜変換していく必要がある。

### binmodeの削除
日本語文字列操作のあるプラグインにおいて
```perl
if (open(my $fh, '>>', $path)) {
	flock($fh, 2);
	binmode($fh);
	print $fh join('<>', time, $bbs, $title)."\n";
	close($fh);
}
```
といった箇所があるとき、```binmode($fh);```は不具合の元であることが多い。(openでの指定に関わらずUTF-8でファイルが生成される)
必要に応じてコメントアウト等を行うこと。

### プラグインファイル名の変更
```0ch_XXX.pl```となっているファイル名を```0ch_XXX_utf8.pl```とする。
これによって本体側でプラグインを認識するようになる。
